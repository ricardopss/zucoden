<!DOCTYPE html>
<html>
<head>
	<title>D3 in Action</title>
</head>
<body onload="createViz()">

<div id="viz">

<svg width="500" height="100" />

</div>

<div id="controls" />

<script src="https://d3js.org/d3.v4.min.js"></script>

<script>


function createViz(){

	d3.csv("https://raw.githubusercontent.com/ricardopss/Visualiza/master/data/worldcup.csv", function(data) {dataViz(data);
	})	
	
	function dataViz(incomingData) {
		
		// ADD CIRCLES ACCORDING TO COUNTRIES
		d3.select("svg")
			.append("g")
			.attr("id", "teamsG")
			.attr("transform", "translate (50, 50)")
			.selectAll("g")
			.data(incomingData)
			.enter()
			.append("g")
			.attr("class", "overallG")
			.attr("transform", (d,i) => "translate(" + (i*50) + ",0)");

		var teamG = d3.selectAll("g.overallG");

		teamG
			.append("circle")
			.style("border", '1px')
			.style("border-color", 'black')
			.style("fill", "gray")
			.attr("r", 0)
			.transition().delay(function(d,i) {return i*100})
			.duration(500)
			.attr("r", 40)
			.transition().duration(500)
			.attr("r", 20);
			//.style("opacity", .50)

		teamG
			.append("text")
			.style("text-anchor", "middle")
			.style("font-size", "10px")
			.style("font-weight", "bolder")
			.attr('y', 30)
			.text(d=> d.team);

		//ADD LABELS TO BUTTONS
		teamG
			.append("text")
			.attr("class", "label-status")	
			.style("text-anchor", "middle")
			.style("font-size", "9px")
			.attr('y', 10)
			
		//ADD BUTTONS
		const dataKeys = Object.keys(incomingData[0])
				.filter(d => d !== "team" && d !== "region")

		d3.select("#controls").selectAll("button.teams")
			.data(dataKeys).enter()
			.append("button")
			.on("click", buttonClick)
			.html(d => d);

		function buttonClick(datapoint) {
			
			var maxValue = d3.max(incomingData, d => parseFloat(d[datapoint]));
			
			var radiusScale = d3.scaleLinear()
								.domain([ 0, maxValue ]).range([ 2, 20 ]);
			
			var selectedG = d3.selectAll("g.overallG");

			selectedG
				.select("circle")
				.transition().duration(1500)
				.attr("r", d => radiusScale(d[datapoint]));

		}
	}
}

</script>

</body>
</html>